{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚´ ì•„ì´í…œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans p-8">

  <h1 class="text-3xl font-bold mb-6 text-center">ğŸ§³ ë‚´ê°€ ë³´ìœ í•œ ì•„ì´í…œ</h1>
  <!-- ğŸ”¸ ë§ì½ì´ ìºë¦­í„°ì™€ íƒ­ ë©”ë‰´ UI -->
  
  <div class="text-center cursor-pointer" onclick="showItems()">
    <div class="flex justify-center items-end gap-6 mb-2">
    
    <!-- âœ… ê¸€ì½ì´ ìºë¦­í„° ê²¹ì³ì§„ êµ¬ì¡° ì‹œì‘ -->
      <div class="text-center cursor-pointer" onclick="showItems()">
        <div class="relative w-80 h-80 mx-auto">
          <!-- ê¸°ë³¸ ê¸€ì½ì´ -->
          <img src="{% static 'images/ê¸€ì½ì´.png' %}" class="absolute top-0 left-0 z-10 w-full">

          <!-- ì°©ìš©ëœ ì•„ì´í…œë“¤ (equipped=True) -->
          {% for ui in equipped_items %}
            <img src="{% static ui.item.image_path %}" class="absolute top-0 left-0 z-20 w-full">
          {% endfor %}
        </div>
        <p class="text-xs mt-1 text-gray-500">ê¸€ì½ì´</p>
      </div>
      <!-- âœ… ê¸€ì½ì´ ìºë¦­í„° ê²¹ì³ì§„ êµ¬ì¡° ë -->

      <!-- ë§ì½ì´ ìºë¦­í„°ëŠ” ê·¸ëŒ€ë¡œ -->
      <div class="text-center">
        <img src="{% static 'images/ë§ì½ì´.png' %}" alt="ë§ì½ì´" class="w-24 mx-auto">
        <p class="text-xs mt-1 text-gray-500">ë§ì½ì´</p>
      </div>
    </div>
    <br>
    <div class="text-center">
      <div class="flex justify-center space-x-4">
        <button onclick="activateButton(this, 'ëª¸ì²´')" class="category-btn text-sm px-4 py-1 rounded-full bg-gray-100 text-gray-500 font-semibold transition transform">ëª¸ì²´</button>
        <button onclick="activateButton(this, 'ê°€ë°©')" class="category-btn text-sm px-4 py-1 rounded-full bg-gray-100 text-gray-500 font-semibold transition transform">ê°€ë°©</button>
        <button onclick="activateButton(this, 'ì•ˆê²½')" class="category-btn text-sm px-4 py-1 rounded-full bg-gray-100 text-gray-500 font-semibold transition transform">ì•ˆê²½</button>
        <button onclick="showAllItems()" class="text-sm px-4 py-1 rounded-full bg-gray-100 text-gray-500 font-semibold">ëª¨ë‘ ë³´ê¸°</button>
      </div>
    </div>
    <br>
    <br>
  </div>

  <!-- ğŸ”¹ ë³´ìœ  ì•„ì´í…œ ì˜ì—­ -->

  <div id="item-section" class="mt-6 mb-20 transition-all duration-300 flex justify-center">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-5xl">
      {% for ui in owned_items %}
      <div class="item-card hidden inline-block text-center"
            data-category="{% if 'geulssung_body' in ui.item.image_path %}ëª¸ì²´{% elif 'geulssung_bag' in ui.item.image_path %}ê°€ë°©{% elif 'geulssung_glass' in ui.item.image_path %}ì•ˆê²½{% else %}ê¸°íƒ€{% endif %}">
          <img src="{% static ui.item.image_path %}"
              onclick="toggleEquip('{{ ui.item.id }}')"
              class="w-52 h-52 rounded shadow cursor-pointer hover:scale-110 transition">
          <p class="text-xs mt-1">
            {% if ui.equipped %}
              <span class="text-green-500">ì°©ìš© ì¤‘</span>
            {% else %}
              <span class="text-gray-400">ë¯¸ì°©ìš©</span>
            {% endif %}
          </p>
        </div>
      {% endfor %}
    </div>
  </div>

  <script>
    function showItems() {
      const section = document.getElementById("item-section");
      section.classList.remove("hidden");
    }
    function toggleEquip(itemId) {
      fetch(`/my-items/toggle-equip/${itemId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
        }
      })
      .then(response => response.json())
      .then(data => {
        console.log("ì„œë²„ ì‘ë‹µ:", data);
        if (data.success) {
          location.reload();  // ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
        } else {
          alert("ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });
    }

    function showAllItems() {
      document.querySelectorAll(".category-btn").forEach(btn => {
        btn.classList.remove("bg-[#00C9A7]", "text-white");
        btn.classList.add("bg-gray-100", "text-gray-500");
      });

      document.querySelectorAll(".item-card").forEach(card => {
        card.classList.remove("hidden");
      });
    }
  
    function activateButton(button, category) {
      document.querySelectorAll(".category-btn").forEach(btn => {
        btn.classList.remove("bg-[#00C9A7]", "text-white");
        btn.classList.add("bg-gray-100", "text-gray-500");
      });
  
      button.classList.remove("bg-gray-100", "text-gray-500");
      button.classList.add("bg-[#00C9A7]", "text-white");
  
      document.querySelectorAll(".item-card").forEach(card => {
        if (card.dataset.category === category) {
          card.classList.remove("hidden");
        } else {
          card.classList.add("hidden");
        }
      });
    }
  
  </script>
</body>
</html>


