{% load static %}
<!DOCTYPE html>
<html lang="ko" style="font-size: 80%;">
<head>
  <meta charset="UTF-8">
  <title>ê¸€ ë¦¬í¬íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
  
  <style>

    /* ======================== í°íŠ¸ í¬ê¸° ì¡°ì • ì˜ì—­ ======================== */
    :root {
      --content-font-size: 16px; /* ğŸ”§ ì—¬ê¸°ì„œ ì „ì²´ ì½˜í…ì¸  í°íŠ¸ í¬ê¸° ì¡°ì • ê°€ëŠ¥ */
    }
    
    body {
      font-family: 'Gowun Batang', serif;
      background-color: #FFF9F2;
      color: #493E3E;
    }
    
    /* ğŸ”§ ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ í°íŠ¸ í¬ê¸° */
    .content-area {
      font-size: var(--content-font-size);
    }
    
    /* ğŸ”§ ì œëª©(h2) í°íŠ¸ í¬ê¸° - ê¸°ë³¸ í°íŠ¸ì˜ 1.8ë°° */
    .content-area h2 {
      font-size: calc(var(--content-font-size) * 1.8);
    }
    
    /* ğŸ”§ ì¼ë°˜ í…ìŠ¤íŠ¸(p) í°íŠ¸ í¬ê¸° */
    .content-area p {
      font-size: var(--content-font-size);
    }
    
    /* ğŸ”§ ì‘ì€ í…ìŠ¤íŠ¸(.text-sm) í°íŠ¸ í¬ê¸° - ê¸°ë³¸ í°íŠ¸ì˜ 0.875ë°° */
    .content-area .text-sm {
      font-size: calc(var(--content-font-size) * 0.875);
    }
  </style>
</head>

<body class="bg-[#f0f9ff] min-h-screen text-[#493E3E] pt-0 px-10 pb-10" style="font-family: 'Gowun Batang', serif;">

  {% include "nav_bar.html" %}

  <!-- ìƒë‹¨ íŒ¨ë”© -->
  <div class="h-20"></div>

  <div class="max-w-4xl mx-auto p-6 bg-white shadow-md mt-6 rounded-3xl content-area">
    <h2 class="bg-cyan-500 text-white text-center py-6 text-3xl font-bold -mx-6 -mt-6 mb-12 rounded-t-3xl">
      ê¸€ ë¦¬í¬íŠ¸
    </h2>

    <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
    <div class="grid grid-cols-3 gap-6 mb-6">
      <!-- í”„ë¡œí•„ ì‚¬ì§„ -->
      <div class="col-span-1">
        <div class="w-full aspect-square bg-gray-200 rounded-md overflow-hidden">
          <img src="{{ profile_image_url }}" alt="{{ user_grade }}" class="w-full h-full object-cover">
        </div>
      </div>

      <!-- ë‹‰ë„¤ì„, ê°€ì…ì¼ -->
      <div class="col-span-1 flex flex-col">
        <div>
          <p class="font-semibold">ë‹‰ë„¤ì„</p>
          <p class="text-sm mt-2">{{ nickname }}</p>
        </div>
        <div>
          <p class="font-semibold mt-20">ê°€ì…ì¼</p>
          <p class="text-sm mt-2">{{ date_joined }}</p>
        </div>
      </div>

      <!-- ë“±ê¸‰, ê¸€ ìˆ˜ -->
      <div class="col-span-1 flex flex-col">
        <div>
          <p class="font-semibold">ê¸€ ë°œí–‰ë“±ê¸‰</p>
          <p class="text-sm mt-2">{{ user_grade }}</p>
        </div>
        <div>
          <p class="font-semibold mt-20">ë°œí–‰ê¸€ ìˆ˜</p>
          <p class="text-sm mt-2">{{ published_posts_count }}</p>
        </div>
      </div>
    </div>

    <!-- ìš”ì•½ + ì ìˆ˜ì¶”ì´ -->
    <div class="grid grid-cols-2 gap-6 mb-6">
      <!-- ìš”ì•½ í…Œì´ë¸” -->
      <div>
        <p class="font-bold mb-2">ìš”ì•½</p>
        <table class="w-full border text-sm">
          <tbody>
            <tr class="border-t">
              <td class="p-2 font-medium w-1/2 bg-gray-50 text-center">ì£¼ìš”í™œë™ì‹œê°„ëŒ€</td>
              <td class="p-2"></td>
            </tr>
            <tr class="border-t">
              <td class="p-2 font-medium bg-gray-50 text-center">Fê¸€/Tê¸€ ì‹œê°„ëŒ€</td>
              <td class="p-2"></td>
            </tr>
            <tr class="border-t">
              <td class="p-2 font-medium bg-gray-50 text-center">í‰ê· /ìµœëŒ€ê¸€ììˆ˜</td>
              <td class="p-2"></td>
            </tr>
            <tr class="border-t">
              <td class="p-2 font-medium bg-gray-50 text-center">í‰ê· /ìµœê³ ì ìˆ˜</td>
              <td class="p-2"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì ìˆ˜ì¶”ì´ ê·¸ë˜í”„ ì˜ì—­ -->
      <div>
        <p class="font-bold mb-2">ì ìˆ˜ì¶”ì´</p>
        <div class="w-full h-40 bg-white p-2 rounded-md border">
          <canvas id="scoreChart" width="400" height="150"></canvas>
        </div>
      </div>
    </div>

    <!-- ì¢…í•© í‰ê°€ ì˜ê²¬ -->
    <div>
      <p class="font-bold mb-2">ì¢…í•© í‰ê°€ ì˜ê²¬</p>
      <div class="w-full h-auto bg-gray-100 p-4 rounded-md text-sm text-gray-600 whitespace-pre-line leading-relaxed my-4">
        {{ gemini_result }}
      </div>
    </div>
  </div>

  <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- ì ìˆ˜ì¶”ì´ ê·¸ë˜í”„ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const canvas = document.getElementById('scoreChart');
      const ctx = canvas.getContext('2d');
      
      // data ì†ì„±ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸° (ì´ë¯¸ JSON ë¬¸ìì—´)
      const scoreLabels = JSON.parse('{{ score_labels|escapejs }}');
      const scoreValues = JSON.parse('{{ score_values|escapejs }}');
      
      // ìµœê³ ì ìˆ˜ ì°¾ê¸°
      const maxScore = Math.max(...scoreValues);
      
      // yì¶• ë²”ìœ„ ë™ì  ê³„ì‚°
      const maxScoreForRange = Math.max(...scoreValues, 10);
      const minScore = Math.min(...scoreValues, 0);
      const yMax = Math.ceil(maxScoreForRange * 1.1); // ìµœëŒ€ê°’ë³´ë‹¤ 10% ë” ë†’ê²Œ
      const yMin = Math.floor(minScore * 0.9); // ìµœì†Œê°’ë³´ë‹¤ 10% ë” ë‚®ê²Œ
      
      const scoreChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: scoreLabels,
          datasets: [{
            label: 'ê¸€ ì ìˆ˜',
            data: scoreValues,
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: scoreValues.map(score => score === maxScore ? 'rgb(239, 68, 68)' : 'rgb(59, 130, 246)'),
            pointBorderColor: scoreValues.map(score => score === maxScore ? '#fff' : '#fff'),
            pointBorderWidth: 2,
            pointRadius: scoreValues.map(score => score === maxScore ? 6 : 4),
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `ì ìˆ˜: ${context.parsed.y}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              min: yMin,
              max: yMax,
              ticks: {
                stepSize: Math.ceil((yMax - yMin) / 5) // 5ê°œ êµ¬ê°„ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          },
          elements: {
            point: {
              hoverBackgroundColor: 'rgb(59, 130, 246)'
            }
          }
        }
      });
    });
  </script>

</body>
</html>
