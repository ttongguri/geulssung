<!-- ìˆ˜ì •ëœ write_form_mobile.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê¸€ì“°ê¸° âœï¸ (ëª¨ë°”ì¼)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap');
    body { font-family: 'Gowun Batang', serif; }
    summary { font-weight: bold; cursor: pointer; }
  </style>
</head>
<body class="bg-[#bae6fd] min-h-screen text-[#493E3E] p-10" style="font-family: 'Gowun Batang', serif;">
  <style>
    .background{
      background-image: url('{% static "images/ìˆ˜ì •.png" %}'); 
      background-size: cover; 
      background-position: center; 
      background-repeat: no-repeat;
    }
  </style>
  {% include "nav_bar_mobile.html" %}
  <div class="bg-white p-4 mt-28 rounded-xl shadow-lg overflow-hidden">
    <form method="post" action="" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="character" id="character-input" value="none">
      <input type="hidden" name="custom_prompt" id="customPromptHidden">

      <!-- 1. ë„ìš°ë¯¸ ì„ íƒ -->
      <div id="step-1" class="step-form flex-1">
      <div class="mb-6">
        <p class="font-semibold text-[#493E3E] mb-2">ì˜¤ëŠ˜ì˜ ê¸€ì“°ê¸° ë„ìš°ë¯¸ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”!</p>
        <div class="flex gap-4">
          <input type="radio" name="category" value="emotion" id="emotion" class="hidden peer/emotion" onchange="handleCharacterSelection(this.value)">
          <label for="emotion"
            class="bg-white text-[#493E3E] px-4 py-2 rounded-full border border-gray-300 font-semibold cursor-pointer transition 
                  peer-checked/emotion:bg-[#00C9A7] peer-checked/emotion:text-white">
            F ê°ì„±ì˜ ê¸€ì½ì´
          </label>

          <input type="radio" name="category" value="logic" id="logic" class="hidden peer/logic" onchange="handleCharacterSelection(this.value)">
          <label for="logic"
            class="bg-white text-[#493E3E] px-4 py-2 rounded-full border border-gray-300 font-semibold cursor-pointer transition 
                  peer-checked/logic:bg-[#00C9A7] peer-checked/logic:text-white">
            T ê°ì„±ì˜ ë§ì½ì´
          </label>
        </div>
      </div>

      <div class="mb-6 hidden" id="genre-emotion">
        <p class="font-semibold text-[#493E3E] mb-2">í˜•ì‹ì„ ê³¨ë¼ë³´ì„¸ìš” (ê¸€ì½ì´)</p>
        <div class="flex gap-4">
          <input type="radio" name="genre" value="essay" id="essay" class="hidden peer/essay" onchange="showGuide(this.value)">
          <label for="essay"
            class="bg-white text-[#493E3E] px-4 py-2 rounded-full border border-gray-300 font-semibold cursor-pointer transition
                  peer-checked/essay:bg-[#00C9A7] peer-checked/essay:text-white">
            ì—ì„¸ì´
          </label>

          <input type="radio" name="genre" value="poem" id="poem" class="hidden peer/poem" onchange="showGuide(this.value)">
          <label for="poem"
            class="bg-white text-[#493E3E] px-4 py-2 rounded-full border border-gray-300 font-semibold cursor-pointer transition
                  peer-checked/poem:bg-[#00C9A7] peer-checked/poem:text-white">
            ì‹œ
          </label>
        </div>
      </div>


      <div class="mb-6 hidden" id="genre-logic">
        <p class="font-semibold text-[#493E3E] mb-2">í˜•ì‹ì„ ê³¨ë¼ë³´ì„¸ìš” (ë§ì½ì´)</p>
        <div class="flex gap-4">
          <input type="radio" name="genre" value="column" id="column" class="hidden peer/column" onchange="showGuide(this.value)">
          <label for="column"
            class="bg-white text-[#493E3E] px-4 py-2 rounded-full border border-gray-300 font-semibold cursor-pointer transition
                  peer-checked/column:bg-[#00C9A7] peer-checked/column:text-white">
            ì¹¼ëŸ¼
          </label>

          <input type="radio" name="genre" value="analysis" id="analysis" class="hidden peer/analysis" onchange="showGuide(this.value)">
          <label for="analysis"
            class="bg-white text-[#493E3E] px-4 py-2 rounded-full border border-gray-300 font-semibold cursor-pointer transition
                  peer-checked/analysis:bg-[#00C9A7] peer-checked/analysis:text-white">
            ë¶„ì„ê¸€
          </label>
        </div>
      </div>



      <div id="prompt-box" class="mb-6 hidden">
        <p class="font-semibold text-[#493E3E] mb-2 flex items-center">
          ğŸ“– ì˜¤ëŠ˜ì˜ ê¸€ê°ì„ ê³¨ë¼ë³´ì„¸ìš”
          <button type="button"
            id="refreshPromptsBtn"
            class="ml-2 px-2 py-1 mb-1 rounded bg-[#bae6fd] text-black text-xs border border-[#7dd3fc]">
            ğŸ”„ ìƒˆë¡œìš´ ê¸€ê°
          </button>
          <button type="button"
            id="customPromptBtn"
            class="ml-2 px-2 py-1 mb-1 rounded bg-[#fef08a] text-black text-xs border border-[#fde68a]">
            âœï¸ ì§ì ‘ ì…ë ¥
          </button>
        </p>
        <p class="text-xs text-gray-500 italic mb-4">
          ì˜¤ëŠ˜ì˜ ê¸€ê°ì€ <a href="https://www.bigkinds.or.kr/" target="_blank" class="underline hover:text-blue-600">ë¹…ì¹´ì¸ì¦ˆ</a>ì—ì„œ ì œê³µí•˜ëŠ” ì˜¤ëŠ˜ì˜ ì´ìŠˆ ê¸°ë°˜ìœ¼ë¡œ ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ì´ˆê¸°í™”ë¼ìš” ğŸ•˜
        </p>
        <div id="prompt-options" class="grid grid-cols-1 gap-4"></div>
        <!-- âœï¸ ììœ  ê¸€ê° ì§ì ‘ ì…ë ¥ (í† ê¸€) -->
        <div id="customPromptInputBox" class="mt-2 hidden">
          <input type="text"
            id="customPromptInput"
            class="w-full border border-gray-300 px-4 py-2 rounded focus:outline-none focus:ring focus:border-blue-300"
            placeholder="ê¸°ë¡í•˜ê³  ì‹¶ì€ ê¸€ê°ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”!"
            maxlength="100"
          />
          <button type="button" id="customPromptSelectBtn" class="mt-2 bg-[#bae6fd] px-3 py-1 rounded">ì„ íƒ</button>
        </div>

      <!-- 4. ê¸€ì“°ê¸° ê°€ì´ë“œ -->
      <div id="guide-scrollable" class="bg-white p-4 rounded-lg shadow">
        <details class="guide-toggle">
          <summary>ğŸ’§ í•œ ë°©ìš¸</summary>
          <div id="guide-template-step1"></div>
        </details>
        <details class="guide-toggle">
          <summary>ğŸ’§ğŸ’§ ë‘ ë°©ìš¸</summary>
          <div id="guide-template-step2"></div>
        </details>
        <details class="guide-toggle">
          <summary>ğŸ’§ğŸ’§ğŸ’§ ì„¸ ë°©ìš¸</summary>
          <div id="guide-template-step3"></div>
        </details>
      </div>

      <!-- 5. ê¸€ì“°ê¸° ì…ë ¥ -->
      <div class="mt-6">
        <label class="block mb-1 font-semibold">ì œëª©</label>
        <input type="text" name="title" class="w-full border px-3 py-2 rounded-md" required />
      </div>

      <div class="mt-6">
        <label class="block mb-1 font-semibold">ğŸ§© ê¸€ì¤„ê¸°</label>
        <textarea name="final_text" rows="8" class="w-full border px-3 py-2 rounded-md" required></textarea>
      </div>

      <div class="mt-6 text-right">
        <button type="submit" class="bg-[#bae6fd] hover:bg-[#7dd3fc] px-6 py-2 rounded-full font-bold text-[#493E3E]">ë³´ê´€í•˜ê¸°</button>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const genreMap = { essay: "ì—ì„¸ì´", poem: "ì‹œ", column: "ì¹¼ëŸ¼", analysis: "ë¶„ì„ê¸€" };

      document.querySelectorAll('input[name="category"]').forEach(radio => {
        radio.addEventListener('change', function () {
          document.getElementById('character-input').value = this.value;
          document.getElementById('genre-emotion').classList.add('hidden');
          document.getElementById('genre-logic').classList.add('hidden');
          if (this.value === 'emotion') document.getElementById('genre-emotion').classList.remove('hidden');
          else if (this.value === 'logic') document.getElementById('genre-logic').classList.remove('hidden');
          document.getElementById('prompt-box').classList.add('hidden');
        });
      });

      document.querySelectorAll('input[name="genre"]').forEach(radio => {
        radio.addEventListener('change', function () {
          const genre = genreMap[this.value];
          document.getElementById('prompt-box').classList.remove('hidden');
          document.getElementById("guide-template-step1").textContent = `í•œ ë°©ìš¸ ê°€ì´ë“œ: ${genre}`;
          document.getElementById("guide-template-step2").textContent = `ë‘ ë°©ìš¸ ê°€ì´ë“œ: ${genre}`;
          document.getElementById("guide-template-step3").textContent = `ì„¸ ë°©ìš¸ ê°€ì´ë“œ: ${genre}`;
        });
      });

      document.getElementById("customPromptBtn").onclick = () => {
        document.getElementById("customPromptInputBox").classList.toggle("hidden");
      };

      document.getElementById("customPromptSelectBtn").onclick = () => {
        const value = document.getElementById("customPromptInput").value.trim();
        if (value) {
          document.getElementById("selectedPrompt").value = value;
          document.getElementById("selectedPromptId").value = "custom";
          document.getElementById("customPromptInputBox").classList.add("hidden");
          document.getElementById("customPromptInput").value = "";
        }
      };
    });
  </script>
</body>
</html>
