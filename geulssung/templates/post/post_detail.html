<!-- templates/post/post_detail.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ post.title }} - ê¸€ì½ê¸€ì½</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap');
    body { font-family: 'Gowun Batang', serif; }
  </style>
</head>
<body class="bg-[#FFF9F2] min-h-screen p-8 relative">
  <!-- í—¤ë” ì˜¤ë¥¸ìª½ ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="absolute top-6 right-8 text-sm space-x-4">
    {% if user.is_authenticated %}
      <span class="text-[#493E3E] font-semibold">{{ user.nickname }}ë‹˜</span>
      <a href="{% url 'logout' %}" class="text-[#493E3E] underline hover:text-gray-600">ë¡œê·¸ì•„ì›ƒ</a>
    {% else %}
      <a href="{% url 'login' %}" class="text-[#493E3E] underline hover:text-gray-600">ë¡œê·¸ì¸</a>
      <a href="{% url 'signup' %}" class="text-[#493E3E] underline hover:text-gray-600">íšŒì›ê°€ì…</a>
    {% endif %}
  </div>

  <!-- ìƒì„¸ë³´ê¸° ì„¹ì…˜ -->
  <div id="detail-content" class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow mt-16">
    <!-- ì¥ë¥´(í•œê¸€) ë° ì£¼ì œ -->
    <p class="text-sm text-gray-600 mb-4">
      {% if post.genre == 'poem' %}
      ì‹œ
      {% elif post.genre == 'column' %}
      ì»¬ëŸ¼
      {% elif post.genre == 'essay' %}
      ì—ì„¸ì´
      {% elif post.genre == 'analysis' %}
      ë¶„ì„ê¸€
      {% else %}
        {{post.genre}}
      {% endif %}
      | {{ post.topic }}</p>

    <!-- ì œëª© -->
    <h1 class="text-3xl font-bold text-[#493E3E] mb-2">{{ post.title }}</h1>

    <!-- ì‘ì„±ì ë° ì‘ì„±ì¼ -->
    <p class="text-sm text-gray-600 mb-6">by {{ post.author.nickname }} | {{ post.created_at|date:"Y.m.d H:i" }}</p>

    <!-- ìŠ¤í… ì „ì²´ í† ê¸€ ë²„íŠ¼ -->
    <button onclick="toggleSteps()"
        class="mb-6 px-4 py-2 bg-[#F9DCC4] hover:bg-[#f7cbaa] text-[#493E3E] rounded-full font-bold transition">
      ğŸ’§ê¸€ë°©ìš¸ ëª¨ì•„ë³´ê¸°
    </button>


    <!-- Step1~3 ì„¹ì…˜ (ê¸°ë³¸ ìˆ¨ê¹€) -->
    <div id="steps-section" class="prose hidden">
      <p class="font-bold text-lg mt-4">Step 1</p>
      <p class="mt-1">{{ post.step1 }}</p>

      <p class="font-bold text-lg mt-6">Step 2</p>
      <p class="mt-1">{{ post.step2 }}</p>

      <p class="font-bold text-lg mt-6">Step 3</p>
      <p class="mt-1">{{ post.step3 }}</p>
    </div>

    <!-- ìµœì¢… ê¸€ ë‚´ìš© -->
    <div class="prose mt-8">
      <p class="font-bold text-xl">ğŸ§© ê¸€ì¤„ê¸°</p>
      <p class="mt-2">{{ post.final_content|linebreaks }}</p>
    </div>

    <!-- ê³µê°œ/ë¹„ê³µê°œ í† ê¸€ ë¼ë””ì˜¤ -->
    <div class="flex space-x-8 mt-8">
      <!-- ê³µê°œ ë¼ë””ì˜¤ -->
      <label class="inline-flex items-center cursor-pointer space-x-2">
        <input type="radio" name="visibility" value="public" class="hidden peer" checked>
        <span class="w-5 h-5 inline-block rounded-full border-2 border-gray-300 peer-checked:border-[#493E3E] peer-checked:bg-[#493E3E]"></span>
        <span class="text-base text-gray-700 peer-checked:text-[#493E3E]">ê³µê°œ</span>
      </label>
      <!-- ë¹„ê³µê°œ ë¼ë””ì˜¤ -->
      <label class="inline-flex items-center cursor-pointer space-x-2">
        <input type="radio" name="visibility" value="private" class="hidden peer">
        <span class="w-5 h-5 inline-block rounded-full border-2 border-gray-300 peer-checked:border-[#493E3E] peer-checked:bg-[#493E3E]"></span>
        <span class="text-base text-gray-700 peer-checked:text-[#493E3E]">ë¹„ê³µê°œ</span>
      </label>
    </div>

    <!-- ë¼ë””ì˜¤ ì„ íƒ ë©”ì‹œì§€ -->
    <p id="visibility-message" class="mt-4 text-md text-gray-600">ì´ ê¸€ì€ ê³µê°œë©ë‹ˆë‹¤.</p>

    <!-- ìœ ì €í˜ì´ì§€ ì´ë™ ë²„íŠ¼ -->
  <div class="flex justify-center space-x-4 mt-8">
    <a href="{% url 'home' %}" 
      class="px-4 py-2 bg-[#F9DCC4] hover:bg-[#f7cbaa] text-[#493E3E] rounded-full font-bold transition">
      í™ˆìœ¼ë¡œ ì´ë™
    </a>
    <a href="{% url 'public_user_posts' post.author.nickname %}" 
      class="px-4 py-2 bg-[#F9DCC4] hover:bg-[#f7cbaa] text-[#493E3E] rounded-full font-bold transition">
      ê¸€ìêµ­ìœ¼ë¡œ ì´ë™
    </a>
  </div>
  
  <!-- ìˆ˜ì • ì„¹ì…˜ (ìˆ¨ê¹€) -->
  <div id="edit-section" class="hidden max-w-3xl mx-auto bg-white p-6 rounded-xl shadow mt-16">
    <form method="post">
      {% csrf_token %}
      <div class="mb-8 mt-8">
        <p class="font-bold text-[#493E3E] text-lg mb-2">ğŸ§© ê¸€ì¤„ê¸°: í•˜ë‚˜ì˜ ê¸€ë¡œ ì™„ì„±í•´ë³´ì„¸ìš”</p>
        <p class="text-sm text-gray-700 mb-3">
          ìœ„ ë‹¨ê³„ë³„ ì‘ì„± ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬, ë‹¹ì‹ ì˜ ìƒê°ì„ í•˜ë‚˜ì˜ íë¦„ ìˆëŠ” ê¸€ë¡œ ì •ë¦¬í•´ë³´ì„¸ìš”.<br />
          ì´ ê¸€ì€ ì‹¤ì œ ì œì¶œ ë° ê³µê°œ ê¸€ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆì–´ìš” âœï¸
        </p>
        <textarea name="final_text" rows="10" class="w-full border px-4 py-3 rounded-md shadow-sm" required>{{ post.final_content }}</textarea>
      </div>
      <div class="flex justify-between mt-4">
        <button type="button" id="prev-btn" class="bg-gray-200 px-4 py-2 rounded-full">â† ì´ì „</button>
        <button type="submit" class="bg-[#F9DCC4] hover:bg-[#f7cbaa] text-[#493E3E] font-bold px-6 py-3 rounded-full transition">
          ì œì¶œí•˜ê¸°
        </button>
      </div>
    </form>
  </div>

  <script>
    // ìŠ¤í… í† ê¸€ í•¨ìˆ˜
    function toggleSteps() {
      const section = document.getElementById('steps-section');
      section.classList.toggle('hidden');
      if (!section.classList.contains('hidden')) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // ê³µê°œ/ë¹„ê³µê°œ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
    document.querySelectorAll('input[name="visibility"]').forEach(input => {
      input.addEventListener('change', () => {
        const msg = document.getElementById('visibility-message');
        msg.textContent = input.value === 'public'
          ? 'ì´ ê¸€ì€ ê³µê°œë©ë‹ˆë‹¤.'
          : 'ì´ ê¸€ì€ ë‚˜ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
      });
    });
  </script>


</body>
</html>